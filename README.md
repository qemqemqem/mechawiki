# MechaWiki ğŸ°

**AI-powered story analysis and wiki generation system with real-time agent monitoring**

MechaWiki is a project that uses AI agents to read stories, write stories, and create interactive RPG experiences - all while building a wiki of structured content.

## Quick Start

```bash
./start.sh
```

Visit **http://localhost:5173** to see the UI!

The system starts with **3 demo agents** (one of each type), **truly paused from the start** (no race conditions!):
- ğŸ¤– **Reader Agent 1** (ReaderAgent) - Reads articles and advances through stories
- âœï¸ **Writer Agent 1** (WriterAgent) - Writes stories from wiki content
- ğŸ® **Interactive Agent 1** (InteractiveAgent) - Creates interactive experiences

**To activate:** Click the â–¶ï¸ resume button in the UI for each agent you want to run.

**Create new agents:** Use the "New Agent" button - these start running immediately.

### âš¡ Real Agents Enabled by Default!

MechaWiki now uses **real LLM-powered agents** by default:
- Event-based generators that yield events instead of printing
- AgentRunner consumes events and writes to JSONL logs
- Line-at-a-time buffering for responsive streaming
- 300k context limit with automatic archiving
- All 3 agent types: ReaderAgent, WriterAgent, InteractiveAgent

**Requirements:** Add your Claude API key to `config.toml`

**Switch to mock agents:** Run with `USE_REAL_AGENTS=false ./start.sh`

**Test without UI:** `python test_real_agents.py`

### ğŸ—‚ï¸ Session Management

MechaWiki supports multiple sessions - each with its own agents and wikicontent branch:

```bash
# Development session (auto-cleaned on start)
./start.sh

# Create a new persistent session
SESSION_NAME=tales_of_wonder ./start.sh
```

**First time with a new session?** An interactive setup wizard will guide you through:
- Branch selection (auto-detected from wikicontent)
- Session configuration
- Directory structure creation

**Already configured?** It just loads and runs!

**Note:** `dev_session` is wiped clean on every start! Use a different session name to preserve state.

See **[Session Setup Guide](notes/session_setup.md)** for details!

See `notes/IMPLEMENTATION_COMPLETE.md` for full details!

## What Is This?

MechaWiki uses AI agents that read through stories (like *Dracula* or *Tales of Wonder*) and automatically create wiki-style documentation about characters, locations, themes, and plot points. It can also work in reverse - taking wiki content and writing stories from it.

### Agent Types (v0)

- **Reader Agent** - Processes stories chunk-by-chunk, creates wiki articles, generates images
- **Writer Agent** - Takes wiki content and writes compelling prose
- **Interactive Agent** - Creates RPG-like experiences where users become part of the story

## Features

### ğŸ® Real-Time Agent Monitoring
Watch your agents work through a beautiful RPG-inspired interface:
- See agent status (â—running, â—‰waiting for input, â—paused)
- View tool calls, messages, and thinking in real-time
- Chat with agents while they're working
- Pause/resume/archive agents on the fly

### ğŸ“š Live Wiki Feed
Track file changes as agents create and edit wiki content:
- Chronological feed of all file operations
- Diff summaries (+17 -5 lines changed)
- Filter by specific agent
- Click to view/edit files with Monaco editor

### ğŸ“ Wiki-Style Content
- Markdown articles with clickable internal links
- Images generated by agents
- Structured data about stories
- Full edit capabilities through the UI

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (React)                  â”‚
â”‚  - Agents Pane: Command Center & Agent Views        â”‚
â”‚  - Files Pane: Feed & Viewer (Monaco Editor)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ SSE (Real-time updates)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Backend (Flask)                      â”‚
â”‚  - Agent Management API                              â”‚
â”‚  - File Serving & Editing API                       â”‚
â”‚  - Log Watcher (monitors agent JSONL files)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agent Log Files (JSONL)                 â”‚
â”‚  data/logs/agent_{id}.jsonl                         â”‚
â”‚  - All agent actions logged here                    â”‚
â”‚  - Backend watches these for updates                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Innovation**: Instead of watching the file system directly, we watch agent log files. This gives us perfect attribution, complete history, and eliminates race conditions.

## Project Structure

- **`src/server/`** - Flask backend (Python)
- **`src/ui/`** - React frontend (Vite)
- **`src/agents/`** - Agent implementations
- **`src/tools/`** - Agent tools (read/write articles, search, images)
- **`data/sessions/dev_session/`** - Active session (agents, logs, config)
- **`~/Dev/wikicontent/`** - Wiki content repository (git-managed separately)

### Session Structure

Each session tracks its git branch and agents:
```
data/sessions/dev_session/
â”œâ”€â”€ config.yaml      # Session config (git branch, etc)
â”œâ”€â”€ agents.json      # Agents in this session
â””â”€â”€ logs/            # Agent JSONL logs
```

See **[Session Management](notes/sessions.md)** for details.

## Documentation

- **[UI Documentation](src/ui/README.md)** - Frontend setup and architecture
- **[Session Management](notes/sessions.md)** - How sessions work
- **[Plan Document](notes/ui_plan.md)** - Full design and implementation plan
- **[Agent User Stories](notes/agents_user_stories.md)** - Agent types and use cases
- **[Agent Implementation](notes/agents_tools_and_implementation.md)** - Technical details

## Requirements

- **Python 3.8+** with pip
- **Node.js 18+** with npm
- **Git** (for wikicontent management)

All dependencies are auto-installed by `start.sh`.

## Development

### Backend Only
```bash
source .venv/bin/activate
python run_server.py
```

### Frontend Only
```bash
cd src/ui
npm run dev
```

### Test Real Agents
```bash
source .venv/bin/activate
python test_real_agents.py
```

This tests:
- Event streaming from BaseAgent
- AgentRunner event consumption
- All 3 agent types (Reader, Writer, Interactive)
- JSONL logging

### Initialize Mock Test Agents (Default)
```bash
source .venv/bin/activate
python src/server/init_agents.py --start
```

### Run Single Mock Agent (for testing)
```bash
source .venv/bin/activate
python src/agents/mock_agent.py
```

## Philosophy

This project follows XP (Extreme Programming) principles with an RPG flavor:

- **"Swift and Decisive"** - Real-time updates, fast iteration
- **"Strong defenses win campaigns"** - Log-based architecture prevents bugs
- **"The Working Code"** - Focus on delivering value, not perfect plans
- **"One quest at a time"** - Clean separation of concerns

## Status

**Phase 1: Foundation** âœ… COMPLETE
- Flask backend with SSE
- React frontend with RPG theme
- Mock agents for testing
- Real-time log streaming
- File viewing and editing

**Next Steps:**
- Integrate real LLM-powered agents
- Add Researcher & Recorder agents
- Enhanced file diff views
- Agent-to-agent messaging

---

**Built with passion for working code and epic adventures.** ğŸ°âš”ï¸
