# Real Agents Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MECHAWIKI UI                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Agents Pane    â”‚              â”‚ Files Pane           â”‚       â”‚
â”‚  â”‚ - Command Ctr  â”‚â—„â”€â”€â”€â”€SSEâ”€â”€â”€â”€â”€â”€â”¤ - Files Feed         â”‚       â”‚
â”‚  â”‚ - Agent View   â”‚              â”‚ - File Viewer        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ REST API
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FLASK BACKEND                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ AgentManager (Singleton)                                 â”‚   â”‚
â”‚  â”‚  - start_agent(id, type, log_file, session_config)      â”‚   â”‚
â”‚  â”‚  - stop_agent(id)                                        â”‚   â”‚
â”‚  â”‚  - Agent Registry: {agent_id: AgentRunner}              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ LogManager + FileWatcher (watchdog)                      â”‚   â”‚
â”‚  â”‚  - Watches: data/sessions/dev_session/logs/*.jsonl      â”‚   â”‚
â”‚  â”‚  - Streams via SSE to frontend                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT LAYER (Background Threads)              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ AgentRunner (Wrapper)                                  â”‚     â”‚
â”‚  â”‚  - Wraps BaseAgent subclass                            â”‚     â”‚
â”‚  â”‚  - Intercepts print() â†’ logs                           â”‚     â”‚
â”‚  â”‚  - Intercepts tool calls â†’ logs                        â”‚     â”‚
â”‚  â”‚  - Checks log file for control signals (pause/resume)  â”‚     â”‚
â”‚  â”‚  - Runs in background thread                           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ BaseAgent (base_agent/base_agent.py)                   â”‚     â”‚
â”‚  â”‚  - litellm.completion() - LLM calls                    â”‚     â”‚
â”‚  â”‚  - Streaming token handling                            â”‚     â”‚
â”‚  â”‚  - Tool execution via _execute_tool()                  â”‚     â”‚
â”‚  â”‚  - Conversation history management                     â”‚     â”‚
â”‚  â”‚  - Memory dict for agent state                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚ Inheritance                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                            â”‚             â”‚              â”‚    â”‚
â”‚  â”‚ ReaderAgent               WriterAgent   Interactive     â”‚    â”‚
â”‚  â”‚  + StoryWindow             Agent        Agent           â”‚    â”‚
â”‚  â”‚  + advance()               + write()    + send_prose()  â”‚    â”‚
â”‚  â”‚  + get_status()            + edit()     + request_input â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TOOLS LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ articles.py      â”‚  â”‚ search.py        â”‚  â”‚ images.py      â”‚ â”‚
â”‚  â”‚ - read_article() â”‚  â”‚ - find_articles()â”‚  â”‚ - create_image â”‚ â”‚
â”‚  â”‚ - write_article()â”‚  â”‚ - find_images()  â”‚  â”‚                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ story.py (NEW)   â”‚  â”‚ interactive.py   â”‚                     â”‚
â”‚  â”‚ - write_story()  â”‚  â”‚ (NEW)            â”‚                     â”‚
â”‚  â”‚ - edit_story()   â”‚  â”‚ - send_prose()   â”‚                     â”‚
â”‚  â”‚ - get_status()   â”‚  â”‚ - request_input()â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA/STORAGE LAYER                          â”‚
â”‚                                                                  â”‚
â”‚  data/sessions/dev_session/                                      â”‚
â”‚  â”œâ”€â”€ config.yaml          â† Git branch, session settings        â”‚
â”‚  â”œâ”€â”€ agents.json          â† Agent definitions                   â”‚
â”‚  â””â”€â”€ logs/                                                       â”‚
â”‚      â”œâ”€â”€ agent_reader-001.jsonl  â† All reader activity          â”‚
â”‚      â”œâ”€â”€ agent_writer-001.jsonl  â† All writer activity          â”‚
â”‚      â””â”€â”€ agent_interactive-001.jsonl                             â”‚
â”‚                                                                  â”‚
â”‚  ~/Dev/wikicontent/       â† Wiki articles (git-managed)         â”‚
â”‚  â””â”€â”€ articles/*.md                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Creating and Running an Agent

```
1. USER clicks "+ New Agent" in UI
   â†“
2. UI sends POST /api/agents/create
   {
     "name": "Reader Agent 1",
     "type": "ReaderAgent", 
     "config": {"description": "...", "story": "tales_of_wonder"}
   }
   â†“
3. FLASK creates agent in session_config.agents.json
   â†“
4. FLASK creates empty log file: data/sessions/dev_session/logs/agent_reader-001.jsonl
   â†“
5. FLASK tells LogManager to watch the log file
   â†“
6. FLASK tells AgentManager to start the agent
   â†“
7. AGENTMANAGER creates AgentRunner(ReaderAgent, ...)
   â†“
8. AGENTRUNNER starts background thread
   â†“
9. AGENTRUNNER writes {"type": "status", "status": "running", ...} to log
   â†“
10. LOGMANAGER detects log change, streams to UI via SSE
   â†“
11. UI shows agent as â— running
   â†“
12. AGENTRUNNER calls agent.run_forever(max_turns=1)
    â†“
13. BASEAGENT calls litellm.completion() with tools
    â†“
14. LLM responds with tool call: advance(num_words=500)
    â†“
15. BASEAGENT executes tool via _execute_tool()
    â†“
16. AGENTRUNNER intercepts and logs:
    {"type": "tool_call", "tool": "advance", "args": {...}}
    {"type": "tool_result", "tool": "advance", "result": "..."}
    â†“
17. LOGMANAGER streams to UI
    â†“
18. UI updates "Last Action: advance to word 500"
    â†“
19. Loop continues...
```

---

## Control Flow: Pausing an Agent

```
1. USER clicks "Pause" button on agent
   â†“
2. UI sends POST /api/agents/{id}/pause
   â†“
3. FLASK writes to log:
   {"type": "status", "status": "paused", "message": "Paused by user"}
   â†“
4. LOGMANAGER detects change, streams to UI
   â†“
5. UI shows agent as â— paused
   â†“
   (Meanwhile, in background thread...)
   â†“
6. AGENTRUNNER._check_control_signals() reads log file
   â†“
7. AGENTRUNNER sees "status": "paused" entry
   â†“
8. AGENTRUNNER sets self.paused = True
   â†“
9. In _run_loop(), agent skips turn:
   if self.paused:
       time.sleep(0.5)
       continue
   â†“
10. Agent stops taking actions but thread stays alive
```

---

## Key Insight: Log-Based Architecture

**Why logs are the source of truth:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Traditional Approach (Shared State)                            â”‚
â”‚                                                                 â”‚
â”‚  Flask Thread â”€â”€â”€â”€â–º shared_dict["agent_id"] = "paused"         â”‚
â”‚                     â–²                                           â”‚
â”‚                     â”‚ Race conditions!                          â”‚
â”‚                     â”‚ Lost on restart!                          â”‚
â”‚  Agent Thread â”€â”€â”€â”€â”€â”˜                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MechaWiki Approach (Log-Based)                                 â”‚
â”‚                                                                 â”‚
â”‚  Flask Thread â”€â”€â”€â”€â–º write_to_log("status": "paused")           â”‚
â”‚                                         â”‚                       â”‚
â”‚                                         â”‚ File system           â”‚
â”‚                                         â”‚ Persistent!           â”‚
â”‚                                         â–¼                       â”‚
â”‚  Agent Thread â”€â”€â”€â”€â–º read_log() â”€â”€â–º sees "paused" â”€â”€â–º pauses    â”‚
â”‚                                                                 â”‚
â”‚  Benefits:                                                      â”‚
â”‚  âœ“ No shared state / race conditions                           â”‚
â”‚  âœ“ Survives restarts (replay from log)                         â”‚
â”‚  âœ“ Complete audit trail                                        â”‚
â”‚  âœ“ Works for both threads AND processes                        â”‚
â”‚  âœ“ UI gets same data (LogManager watches same file)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tool Execution Flow

```
LLM says: "Let me read the London article"
   â†“
LLM makes tool call: read_article(article_name="london")
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AGENTRUNNER intercepts                                   â”‚
â”‚   1. Logs: {"type": "tool_call", ...}                    â”‚
â”‚   2. Calls original _execute_tool()                      â”‚
â”‚      â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ BASEAGENT._execute_tool()                        â”‚   â”‚
â”‚   â”‚   - Finds tool in self.tools                     â”‚   â”‚
â”‚   â”‚   - Gets actual function: read_article()         â”‚   â”‚
â”‚   â”‚   - Calls it with args                           â”‚   â”‚
â”‚   â”‚      â†“                                            â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚   â”‚ TOOL: read_article()                       â”‚ â”‚   â”‚
â”‚   â”‚   â”‚   - Opens ~/Dev/wikicontent/articles/      â”‚ â”‚   â”‚
â”‚   â”‚   â”‚   - Reads london.md                        â”‚ â”‚   â”‚
â”‚   â”‚   â”‚   - Returns content string                 â”‚ â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚      â†“                                            â”‚   â”‚
â”‚   â”‚   Returns result to BASEAGENT                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â†“                                                    â”‚
â”‚   3. Logs: {"type": "tool_result", "result": "# London\n..."}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
BASEAGENT adds tool result to conversation
   â†“
BASEAGENT calls LLM again with result
   â†“
LLM: "The London article describes a mythical city..."
```

---

## Memory Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReaderAgent Memory                                      â”‚
â”‚                                                         â”‚
â”‚  self.memory = {                                        â”‚
â”‚    "story_name": "tales_of_wonder",                     â”‚
â”‚    "story_path": "/path/to/story.txt",                  â”‚
â”‚    "current_position": 1500,                            â”‚
â”‚    "total_words": 50000,                                â”‚
â”‚    "progress_percent": 3.0,                             â”‚
â”‚    "is_complete": False,                                â”‚
â”‚    "articles_created": ["london", "wizard-merlin"],     â”‚
â”‚    "images_created": ["london-skyline.png"]             â”‚
â”‚  }                                                       â”‚
â”‚                                                         â”‚
â”‚  Accessed via:                                          â”‚
â”‚    self.get_memory("current_position")                  â”‚
â”‚    self.set_memory("articles_created", [...])           â”‚
â”‚    self.update_memory({"current_position": 2000})       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conversation History (BaseAgent.messages)               â”‚
â”‚                                                         â”‚
â”‚  [                                                      â”‚
â”‚    {"role": "system", "content": "You are a reader..."} â”‚
â”‚    {"role": "user", "content": "Start reading"}        â”‚
â”‚    {"role": "assistant", "content": "...",              â”‚
â”‚     "tool_calls": [...]},                               â”‚
â”‚    {"role": "tool", "tool_call_id": "...",              â”‚
â”‚     "content": "Advanced to word 500"},                 â”‚
â”‚    {"role": "user", "content": "Story chunk:\n\n..."},  â”‚
â”‚    {"role": "assistant", "content": "This scene..."}    â”‚
â”‚  ]                                                      â”‚
â”‚                                                         â”‚
â”‚  Context Management (advance_content):                  â”‚
â”‚    - Keeps last N story chunks active                   â”‚
â”‚    - Archives older chunks to prevent bloat             â”‚
â”‚    - Tagged with _advance_content flag                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This architecture is elegant, scalable, and already half-built!** ğŸ°âš”ï¸

